let aidExampleDataCSV= `year;month;grant_date;benef_id;benef_name;benef_type;purpose;grantor;grant_type;amt_granted;amt_paid;reimbursed;refunded;region_name;sec_cod;sec_descr;aid_type;reg_base;fund_local;fund_regional;fund_state;fund_eu;fund_other;fund_type;prov_name;mun_name
2024;12;30/12/2024;;PERSONA FÍSICA QUE NO DESARROLLA ACTIVIDAD ECONÓMICA;PERSONAS FÍSICAS QUE NO DESARROLLAN ACTIVIDAD ECONÓMICA;Acceso a la vivienda y fomento de la edificación;Secretaria Autonómica de Vivienda;Concurrencia;23382.48;0;0;0;Alicante / Alacant;;;SUBVENCIÓN y ENTREGA DINERARIA SIN CONTRAPRESTACIÓN;PROYECTO ORDEN BASES REGULADORAS CONCESIÓN AYUDAS MEJORA ACCESIBILIDAD A LAS VIVIENDAS PLAN ESTATAL 2022-2025 AÑO 2023;0;5458584;12736696;0;0;Autonómica, Estatal;Alicante/Alacant;Crevillent
2024;12;30/12/2024;E42665265;HERMANOS FERNANDEZ SLAATTEN CB;PERSONAS JURÍDICAS QUE NO DESARROLLAN ACTIVIDAD ECONÓMICA;Acceso a la vivienda y fomento de la edificación;Secretaria Autonómica de Vivienda;Concurrencia;55660.36;0;0;0;Alicante / Alacant;;;SUBVENCIÓN y ENTREGA DINERARIA SIN CONTRAPRESTACIÓN;PROYECTO ORDEN BASES REGULADORAS CONCESIÓN AYUDAS MEJORA ACCESIBILIDAD A LAS VIVIENDAS PLAN ESTATAL 2022-2025 AÑO 2023;0;5458584;12736696;0;0;Autonómica, Estatal;Alicante/Alacant;Alacant/Alicante
2024;12;30/12/2024;E03520822;CDAD PROP EDFICIO PARQUE;PERSONAS JURÍDICAS QUE NO DESARROLLAN ACTIVIDAD ECONÓMICA;Acceso a la vivienda y fomento de la edificación;Secretaria Autonómica de Vivienda;Concurrencia;60286.35;0;0;0;Alicante / Alacant;;;SUBVENCIÓN y ENTREGA DINERARIA SIN CONTRAPRESTACIÓN;PROYECTO ORDEN BASES REGULADORAS CONCESIÓN AYUDAS MEJORA ACCESIBILIDAD A LAS VIVIENDAS PLAN ESTATAL 2022-2025 AÑO 2023;0;5458584;12736696;0;0;Autonómica, Estatal;Alicante/Alacant;Alacant/Alicante
2024;12;30/12/2024;H03525037;CDAD PROP CALLE RAMON Y CAJAL, 15 DE SANTA POLA;PERSONAS JURÍDICAS QUE NO DESARROLLAN ACTIVIDAD ECONÓMICA;Acceso a la vivienda y fomento de la edificación;Secretaria Autonómica de Vivienda;Concurrencia;27965.38;0;0;0;Alicante / Alacant;;;SUBVENCIÓN y ENTREGA DINERARIA SIN CONTRAPRESTACIÓN;PROYECTO ORDEN BASES REGULADORAS CONCESIÓN AYUDAS MEJORA ACCESIBILIDAD A LAS VIVIENDAS PLAN ESTATAL 2022-2025 AÑO 2023;0;5458584;12736696;0;0;Autonómica, Estatal;Alicante/Alacant;Santa Pola
2024;12;30/12/2024;H03531373;CDAD PROP CALLE DOCTOR GUERAU, 3 DE ALCOY;PERSONAS JURÍDICAS QUE NO DESARROLLAN ACTIVIDAD ECONÓMICA;Acceso a la vivienda y fomento de la edificación;Secretaria Autonómica de Vivienda;Concurrencia;30306.23;0;0;0;Alicante / Alacant;;;SUBVENCIÓN y ENTREGA DINERARIA SIN CONTRAPRESTACIÓN;PROYECTO ORDEN BASES REGULADORAS CONCESIÓN AYUDAS MEJORA ACCESIBILIDAD A LAS VIVIENDAS PLAN ESTATAL 2022-2025 AÑO 2023;0;5458584;12736696;0;0;Autonómica, Estatal;Alicante/Alacant;Alcoi/Alcoy
2024;12;30/12/2024;H03644903;CDAD PROP CL GASPAR QUILES PASCUAL 17 DE ELCHE;PERSONAS JURÍDICAS QUE NO DESARROLLAN ACTIVIDAD ECONÓMICA;Acceso a la vivienda y fomento de la edificación;Secretaria Autonómica de Vivienda;Concurrencia;90250.6;0;0;0;Alicante / Alacant;;;SUBVENCIÓN y ENTREGA DINERARIA SIN CONTRAPRESTACIÓN;PROYECTO ORDEN BASES REGULADORAS CONCESIÓN AYUDAS MEJORA ACCESIBILIDAD A LAS VIVIENDAS PLAN ESTATAL 2022-2025 AÑO 2023;0;5458584;12736696;0;0;Autonómica, Estatal;Alicante/Alacant;Elx/Elche
2024;12;30/12/2024;H03647864;CDAD PROP CL ANTONIO MORA FERRANDEZ 19 DE ELCHE;PERSONAS JURÍDICAS QUE NO DESARROLLAN ACTIVIDAD ECONÓMICA;Acceso a la vivienda y fomento de la edificación;Secretaria Autonómica de Vivienda;Concurrencia;64418.64;0;0;0;Alicante / Alacant;;;SUBVENCIÓN y ENTREGA DINERARIA SIN CONTRAPRESTACIÓN;PROYECTO ORDEN BASES REGULADORAS CONCESIÓN AYUDAS MEJORA ACCESIBILIDAD A LAS VIVIENDAS PLAN ESTATAL 2022-2025 AÑO 2023;0;5458584;12736696;0;0;Autonómica, Estatal;Alicante/Alacant;Elx/Elche
2024;12;30/12/2024;H03648391;CDAD DE PROP DE LA AVENIDA PAIS VALENCIA N 96 DE C;PERSONAS JURÍDICAS QUE NO DESARROLLAN ACTIVIDAD ECONÓMICA;Acceso a la vivienda y fomento de la edificación;Secretaria Autonómica de Vivienda;Concurrencia;46338.17;0;0;0;Alicante / Alacant;;;SUBVENCIÓN y ENTREGA DINERARIA SIN CONTRAPRESTACIÓN;PROYECTO ORDEN BASES REGULADORAS CONCESIÓN AYUDAS MEJORA ACCESIBILIDAD A LAS VIVIENDAS PLAN ESTATAL 2022-2025 AÑO 2023;0;5458584;12736696;0;0;Autonómica, Estatal;Alicante/Alacant;Cocentaina
2024;12;30/12/2024;H54155510;CDAD PROP CLARA CAMPOAMOR 1;PERSONAS JURÍDICAS QUE NO DESARROLLAN ACTIVIDAD ECONÓMICA;Acceso a la vivienda y fomento de la edificación;Secretaria Autonómica de Vivienda;Concurrencia;20217.18;0;0;0;Alicante / Alacant;;;SUBVENCIÓN y ENTREGA DINERARIA SIN CONTRAPRESTACIÓN;PROYECTO ORDEN BASES REGULADORAS CONCESIÓN AYUDAS MEJORA ACCESIBILIDAD A LAS VIVIENDAS PLAN ESTATAL 2022-2025 AÑO 2023;0;5458584;12736696;0;0;Autonómica, Estatal;Alicante/Alacant;Villena
2024;12;30/12/2024;H03538782;CDAD PROP CALLE LA TORRE, 51 DE ELCHE;PERSONAS JURÍDICAS QUE NO DESARROLLAN ACTIVIDAD ECONÓMICA;Acceso a la vivienda y fomento de la edificación;Secretaria Autonómica de Vivienda;Concurrencia;7814.4;0;0;0;Alicante / Alacant;;;SUBVENCIÓN y ENTREGA DINERARIA SIN CONTRAPRESTACIÓN;PROYECTO ORDEN BASES REGULADORAS CONCESIÓN AYUDAS MEJORA ACCESIBILIDAD A LAS VIVIENDAS PLAN ESTATAL 2022-2025 AÑO 2023;0;5458584;12736696;0;0;Autonómica, Estatal;Alicante/Alacant;Elx/Elche`;

const CAMPOS = {
    "year": "integer", "month": "integer", "grant_date": "string", 'benef_id': "string",
    "benef_name": "string", "benef_type": "string", "purpose": "string", "grantor": "string",
    "grant_type": "string", "amt_granted": "float", "amt_paid": "float", "reimbursed": "float",
    "refunded": "float", "region_name": "string", "sec_cod": "integer",
    "sec_descr":"string", "aid_type": "string", "reg_base": "string", "fund_local": "float",
    "fund_regional": "float", "fund_state": "float", "fund_eu": "float", "fund_other": "float",
    "fund_type": "string", "prov_name": "string", "mun_name": "string"
};


let aidExampleArray = aidExampleDataCSV.split(`\n`);
aidExampleArray = aidExampleArray.map(line => {
    line = line.split(`;`);
    let obj = {};
    Object.keys(CAMPOS).forEach((key, i) => {
        let elem = line[i] ? line[i].trim().replace(/"/g, '') : null;
        if (elem !== null) {
            if (CAMPOS[key] === "float") {
                elem = parseFloat(elem);
            } else if (CAMPOS[key] === "integer") {
                elem = parseInt(elem);
            } else {
                if(elem.includes("/") && elem.split("/").length<3){
                    elem = (key==="mun_name") ? elem.split("/").at(1) : elem.split("/").at(0);
                }
            }
        }
        obj[key] = (elem === '' || elem === null) ? null : elem;
    });
    return obj;
});

function avgByMunName(mun){
    let aidByMunName= aidExampleArray.filter(obj => Object.values(obj).find(value => value==mun));
    let total_amt_granted= aidByMunName.reduce((acc, obj) => acc + Number.parseFloat(obj.amt_granted), 0);
    return (total_amt_granted/aidByMunName.length);
}

const mun= 'Elche';
let avg= `La media del monto de ayuda/subvencion concedida para el municipio de ${mun} es de ${avgByMunName(mun).toFixed(2)}€`;
function avgByMunNameRes(){
    console.log(avg);
}
avgByMunNameRes();
module.exports = {aidExampleDataCSV, CAMPOS, aidExampleArray, avgByMunName};